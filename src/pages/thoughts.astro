---
import { getCollection } from "astro:content";
import Card from "../components/card.astro";
import Gap from "../components/gap.astro";
import Heading from "../components/heading.astro";
import Layout from "../components/layout.astro";
import Link from "../components/link.astro";
import { getExcerpt } from "../utils";
import { marked } from "marked";

const thoughts = await getCollection("thoughts");
---

<Layout title="/thoughts">
  <Gap>
    <Heading variant="h1">Thoughts</Heading>
    <ul class="flex list-none! flex-col gap-y-2">
      {
        thoughts
          .sort(
            ({ data: { date: aDate } }, { data: { date: bDate } }) =>
              bDate.getTime() - aDate.getTime(),
          )
          .map(({ data: { description, slug, title }, body }) => (
            <Card classNames="py-2 px-4 flex flex-col gap-2">
              <div>
                <li>
                  <Link classNames="font-bold" to={`/thoughts/${slug}`}>
                    {title.toLowerCase()}
                  </Link>
                </li>
              </div>
              <p set:html={marked.parse(description ?? getExcerpt(body))} />
            </Card>
          ))
      }
    </ul>
  </Gap>
</Layout>
